name: Advanced Branch-Based Notifications

on:
  push:
    branches: ['**']
  pull_request:
    types: [opened, closed]

jobs:
  smart-notification:
    runs-on: ubuntu-latest
    steps:
      - name: Determine Notification Strategy
        id: strategy
        run: |
          BRANCH="${{ github.ref_name }}"
          EVENT="${{ github.event_name }}"

          case "$BRANCH" in
            "main"|"master")
              echo "channel=production" >> $GITHUB_OUTPUT
              echo "color=0xff6b35" >> $GITHUB_OUTPUT
              echo "priority=high" >> $GITHUB_OUTPUT
              ;;
            "develop"|"dev")
              echo "channel=development" >> $GITHUB_OUTPUT
              echo "color=0x4287f5" >> $GITHUB_OUTPUT
              echo "priority=medium" >> $GITHUB_OUTPUT
              ;;
            "feat/"*)
              echo "channel=features" >> $GITHUB_OUTPUT
              echo "color=0x36c759" >> $GITHUB_OUTPUT
              echo "priority=low" >> $GITHUB_OUTPUT
              ;;
            "hotfix/"*)
              echo "channel=urgent" >> $GITHUB_OUTPUT
              echo "color=0xff0000" >> $GITHUB_OUTPUT
              echo "priority=critical" >> $GITHUB_OUTPUT
              ;;
            *)
              echo "channel=general" >> $GITHUB_OUTPUT
              echo "color=0x808080" >> $GITHUB_OUTPUT
              echo "priority=low" >> $GITHUB_OUTPUT
              ;;
          esac

      - name: Production Deployment Alert
        if: steps.strategy.outputs.channel == 'production'
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK_URL }}
          title: "ğŸš€ í”„ë¡œë•ì…˜ ë°°í¬"
          description: |
            **âš ï¸ ì¤‘ìš”**: í”„ë¡œë•ì…˜ í™˜ê²½ì— ìƒˆë¡œìš´ ë³€ê²½ì‚¬í•­ì´ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤.

            **ë°°í¬ ì •ë³´**:
            - ì»¤ë°‹: `${{ github.sha }}`
            - ë°°í¬ì: ${{ github.actor }}
            - ì‹œê°„: ${{ github.event.head_commit.timestamp }}

          color: ${{ steps.strategy.outputs.color }}
          username: Production Bot

      - name: Dev Deployment Alert
        if: steps.strategy.outputs.channel == 'development'
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK_URL }}
          title: "âœ… ê°œë°œì„œë²„ ë°°í¬"
          description: |
            **âœ… ê³µì§€**: ê°œë°œ í™˜ê²½ì— ìƒˆë¡œìš´ ë³€ê²½ì‚¬í•­ì´ ë°°í¬ë˜ì—ˆìŠµë‹ˆë‹¤.

            **ë°°í¬ ì •ë³´**:
            - ì»¤ë°‹: `${{ github.sha }}`
            - ë°°í¬ì: ${{ github.actor }}
            - ì‹œê°„: ${{ github.event.head_commit.timestamp }}

          color: ${{ steps.strategy.outputs.color }}
          username: Dev Bot

      - name: Hotfix Critical Alert
        if: steps.strategy.outputs.priority == 'critical'
        uses: sarisia/actions-status-discord@v1
        with:
          webhook: ${{ secrets.DISCORD_WEBHOOK_URL }}
          content: |
            @everyone ğŸš¨ **ê¸´ê¸‰ í•«í”½ìŠ¤ ë°°í¬**

            í•«í”½ìŠ¤ê°€ ì ìš©ë˜ì—ˆìŠµë‹ˆë‹¤. ëª¨ë“  íŒ€ì›ì€ ê´€ë ¨ ì‹œìŠ¤í…œì„ í™•ì¸í•´ì£¼ì„¸ìš”.
            **ë¸Œëœì¹˜**: ${{ github.ref_name }}
            **ì»¤ë°‹**: ${{ github.sha }}